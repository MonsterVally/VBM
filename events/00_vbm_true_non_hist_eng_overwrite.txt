add_namespace = mtg_britain
# Abdication Crisis Edward VIII
country_event = {
	id = mtg_britain.1
	title = mtg_britain.1.t
	desc = mtg_britain.1.d
	picture = GFX_report_event_eng_edward_and_wallis
	trigger = {
		tag = ENG
		has_country_flag = ENG_king_died
		date > 1936.6.1
		NOT = {
			has_country_flag = ENG_edward_abdicating
		}
		has_dlc = "Man the Guns"
	}
	fire_only_once = yes
	mean_time_to_happen = {
		days = 14
	}
	# Reject
	option = {
		name = mtg_britain.1.c
		ai_chance = {
			factor = 70
			modifier = {
				factor = 0
				OR = {
					has_game_rule = {
						rule = ENG_ai_behavior
						option = NEUTRALITY
					}
					has_country_flag = ENG_AI_RANDOM_NEUTRALITY
				}
			}
		}
		add_stability = 0.05
		set_country_flag = ENG_edward_abdicating
		country_event = {
			id = mtg_britain.14
			days = 5
			random_days = 5
		}
		trigger = {
			if = {
				limit = {
					vbm_true_non_hist_on = yes
				}
				vbm_eng_path_dem_fas_com = yes
			}
		}
	}
	# Accept - Morganatic marriage
	option = {
		name = mtg_britain.1.b
		trigger = {
			NOT = {
				OR = {
					has_completed_focus = ENG_organize_the_blackshirts
					has_completed_focus = ENG_concessions_to_the_trade_unions
					has_completed_focus = ENG_steady_as_she_goes
				}
			}
			if = {
				limit = {
					vbm_true_non_hist_on = yes
				}
				vbm_eng_path_non = yes
			}
		}
		ai_chance = {
			factor = 20
			modifier = {
				factor = 0
				ENG_is_on_historical_plan_trigger = yes
			}
			modifier = {
				factor = 0
				has_completed_focus = ENG_steady_as_she_goes
			}
			modifier = {
				factor = 0
				has_completed_focus = ENG_organize_the_blackshirts
			}
			modifier = {
				factor = 0
				has_completed_focus = ENG_concessions_to_the_trade_unions
			}
			modifier = {
				factor = 0
				OR = {
					has_game_rule = {
						rule = ENG_ai_behavior
						option = DEMOCRATIC_HISTORICAL
					}
					has_game_rule = {
						rule = ENG_ai_behavior
						option = DEMOCRATIC_ALTERNATE
					}
					has_game_rule = {
						rule = ENG_ai_behavior
						option = COMMUNIST
					}
					has_game_rule = {
						rule = ENG_ai_behavior
						option = FASCIST
					}
					has_country_flag = ENG_AI_RANDOM_FASCIST
					has_country_flag = ENG_AI_RANDOM_COMMUNIST
					has_country_flag = ENG_AI_RANDOM_DEMOCRATIC_ALTERNATE
					has_country_flag = ENG_AI_DEMOCRATIC_HISTORICAL
				}
			}
		}
		add_stability = -0.05
		add_popularity = {
			ideology = neutrality
			popularity = 0.05
		}
		custom_effect_tooltip = mtg_britain.1_tt
		activate_mission = ENG_abdication_crisis
		hidden_effect = {
			country_event = {
				id = mtg_britain.2
				days = 50
			}
			country_event = {
				id = mtg_britain.6
				days = 15
				random_days = 10
			}
		}
		set_country_flag = ENG_abdication_crisis_morganatic_marriage
		set_country_flag = edward_viii_refused_to_abdicate_flag
		hidden_effect = {
			CAN = {
				country_event = {
					id = mtg_britain.15
				}
			}
			SAF = {
				country_event = {
					id = mtg_britain.15
				}
			}
			RAJ = {
				country_event = {
					id = mtg_britain.15
				}
			}
			AST = {
				country_event = {
					id = mtg_britain.15
				}
			}
			NZL = {
				country_event = {
					id = mtg_britain.15
				}
			}
			BRM = {
				country_event = {
					id = mtg_britain.15
				}
			}
		}
	}
	# Accept - Normal marriage
	option = {
		name = mtg_britain.1.a
		trigger = {
			NOT = {
				OR = {
					has_completed_focus = ENG_organize_the_blackshirts
					has_completed_focus = ENG_concessions_to_the_trade_unions
					has_completed_focus = ENG_steady_as_she_goes
				}
			}
			if = {
				limit = {
					vbm_true_non_hist_on = yes
				}
				vbm_eng_path_non = yes
			}
		}
		ai_chance = {
			factor = 10
			modifier = {
				factor = 0
				ENG_is_on_historical_plan_trigger = yes
			}
			modifier = {
				factor = 0
				has_completed_focus = ENG_steady_as_she_goes
			}
			modifier = {
				factor = 0
				has_completed_focus = ENG_organize_the_blackshirts
			}
			modifier = {
				factor = 0
				has_completed_focus = ENG_concessions_to_the_trade_unions
			}
			modifier = {
				factor = 0
				OR = {
					has_game_rule = {
						rule = ENG_ai_behavior
						option = DEMOCRATIC_HISTORICAL
					}
					has_game_rule = {
						rule = ENG_ai_behavior
						option = DEMOCRATIC_ALTERNATE
					}
					has_game_rule = {
						rule = ENG_ai_behavior
						option = COMMUNIST
					}
					has_game_rule = {
						rule = ENG_ai_behavior
						option = FASCIST
					}
					has_country_flag = ENG_AI_RANDOM_FASCIST
					has_country_flag = ENG_AI_RANDOM_COMMUNIST
					has_country_flag = ENG_AI_RANDOM_DEMOCRATIC_ALTERNATE
					has_country_flag = ENG_AI_DEMOCRATIC_HISTORICAL
				}
			}
		}
		add_stability = -0.15
		add_popularity = {
			ideology = neutrality
			popularity = 0.1
		}
		add_political_power = -25
		custom_effect_tooltip = mtg_britain.1_tt
		activate_mission = ENG_abdication_crisis
		hidden_effect = {
			country_event = {
				id = mtg_britain.2
				days = 50
			}
			country_event = {
				id = mtg_britain.6
				days = 15
				random_days = 10
			}
		}
		set_country_flag = ENG_abdication_crisis_normal_marriage
		set_country_flag = edward_viii_refused_to_abdicate_flag
		hidden_effect = {
			CAN = {
				country_event = {
					id = mtg_britain.15
				}
			}
			SAF = {
				country_event = {
					id = mtg_britain.15
				}
			}
			RAJ = {
				country_event = {
					id = mtg_britain.15
				}
			}
			AST = {
				country_event = {
					id = mtg_britain.15
				}
			}
			NZL = {
				country_event = {
					id = mtg_britain.15
				}
			}
			BRM = {
				country_event = {
					id = mtg_britain.15
				}
			}
		}
	}
}

# Abdication Crisis Edward VIII - King's support coalesces
country_event = {
	id = mtg_britain.2
	title = mtg_britain.2.t
	desc = mtg_britain.2.d
	picture = GFX_report_event_generic_rally
	is_triggered_only = yes
	# Ok
	option = {
		name = mtg_britain.2.a
		add_popularity = {
			ideology = neutrality
			popularity = 0.1
		}
		add_political_power = 100
		add_timed_idea = {
			idea = ENG_support_for_the_king_idea
			days = 150
		}
		custom_effect_tooltip = mtg_britain.2_tt
		hidden_effect = {
			country_event = {
				id = mtg_britain.3
				days = 50
			}
		}
		# NON
		trigger = {
			if = {
				limit = {
					vbm_true_non_hist_on = yes
				}
				vbm_eng_path_non = yes
			}
		}
	}
	# On second thought, maybe we shouldn't
	option = {
		name = mtg_britain.2.b
		ai_chance = {
			factor = 0
		}
		country_event = {
			id = mtg_britain.14
			days = 40
			random_days = 10
		}
		# DEM
		trigger = {
			if = {
				limit = {
					vbm_true_non_hist_on = yes
				}
				vbm_eng_path_dem_fas_com = yes
			}
		}
		set_country_flag = ENG_abdication_crisis_changed_mind
	}
}

# Abdication Crisis Edward VIII - Government falls
country_event = {
	id = mtg_britain.3
	title = mtg_britain.3.t
	desc = mtg_britain.3.d
	picture = GFX_report_event_generic_sign_treaty2
	is_triggered_only = yes
	trigger = {
		NOT = {
			has_country_flag = ENG_abdication_crisis_changed_mind
		}
	}
	# Ok
	option = {
		name = mtg_britain.3.a
		add_stability = -0.15
		add_political_power = -150
		create_country_leader = {
			name = "Fallen Government"
			desc = "POLITICS_FALLEN_GOVERNMENT_DESC"
			picture = GFX_portrait_Fallen_Government
			expire = "1965.1.1"
			ideology = conservatism
			traits = {
				cabinet_crisis
			}
		}
		custom_effect_tooltip = mtg_britain.2_tt
		set_country_flag = ENG_abdication_crisis_government_fell
		hidden_effect = {
			country_event = {
				id = mtg_britain.4
				days = 50
			}
		}
		# NON
		trigger = {
			if = {
				limit = {
					vbm_true_non_hist_on = yes
				}
				vbm_eng_path_non = yes
			}
		}
	}
	# On second thought, maybe we shouldn't
	option = {
		name = mtg_britain.2.b
		ai_chance = {
			factor = 0
		}
		country_event = {
			id = mtg_britain.14
			days = 40
			random_days = 10
		}
		set_country_flag = ENG_abdication_crisis_changed_mind
		if = {
			limit = {
				has_idea = ENG_support_for_the_king_idea
			}
			remove_ideas = ENG_support_for_the_king_idea
		}
		# DEM
		trigger = {
			if = {
				limit = {
					vbm_true_non_hist_on = yes
				}
				vbm_eng_path_dem_fas_com = yes
			}
		}
	}
}

# Abdication Crisis Edward VIII - Dominions threaten to break away
country_event = {
	id = mtg_britain.4
	title = mtg_britain.4.t
	desc = mtg_britain.4.d
	picture = GFX_report_event_generic_sign_treaty3
	is_triggered_only = yes
	trigger = {
		NOT = {
			has_country_flag = ENG_abdication_crisis_changed_mind
		}
	}
	# Ok
	option = {
		name = mtg_britain.4.a
		add_stability = -0.15
		add_political_power = -100
		if = {
			limit = {
				CAN = {
					has_country_flag = ENG_abdication_crisis_dominion_will_leave
				}
				SAF = {
					has_country_flag = ENG_abdication_crisis_dominion_will_leave
				}
				RAJ = {
					has_country_flag = ENG_abdication_crisis_dominion_will_leave
				}
				AST = {
					has_country_flag = ENG_abdication_crisis_dominion_will_leave
				}
				NZL = {
					has_country_flag = ENG_abdication_crisis_dominion_will_leave
				}
				BRM = {
					has_country_flag = ENG_abdication_crisis_dominion_will_leave
				}
			}
			dismantle_faction = yes
		}
		remove_from_tech_sharing_group = commonwealth_research
		effect_tooltip = {
			if = {
				limit = {
					CAN = {
						has_country_flag = ENG_abdication_crisis_dominion_will_leave
					}
				}
				set_autonomy = {
					target = CAN
					autonomy_state = autonomy_free
				}
			}
			if = {
				limit = {
					SAF = {
						has_country_flag = ENG_abdication_crisis_dominion_will_leave
					}
				}
				set_autonomy = {
					target = SAF
					autonomy_state = autonomy_free
				}
			}
			if = {
				limit = {
					RAJ = {
						has_country_flag = ENG_abdication_crisis_dominion_will_leave
					}
				}
				if = {
					limit = {
						NOT = {
							has_dlc = "Graveyard of Empires"
						}
					}
					set_autonomy = {
						target = RAJ
						autonomy_state = autonomy_free
					}
					RAJ = {
						drop_cosmetic_tag = yes
						retire_country_leader = yes
						remove_from_tech_sharing_group = commonwealth_research
					}
				}
				else = {
					if = {
						limit = {
							RAJ = {
								is_subject_of = ENG
							}
						}
						#retire_country_leader = yes
						RAJ = {
							country_event = {
								id = GOE_RAJ.30
								hours = 2
							}
							remove_from_tech_sharing_group = commonwealth_research
							effect_tooltip = {
								add_ideas = idea_RAJ_the_long_goodbye
							}
							if = {
								limit = {
									NOT = {
										has_autonomy_state = autonomy_dominion
									}
								}
								set_autonomy = {
									target = RAJ
									autonomy_state = autonomy_dominion
									freedom_level = 0									# 0-1 
									end_wars = no									# default yes. will not cancel non civil wars if set to no
									end_civil_wars = no									# default yes. will not cancel civil wars if set to no
								}
							}
						}
						custom_effect_tooltip = GOE_RAJ.30_we_are_leaving_tt
					}
				}
			}
			if = {
				limit = {
					AST = {
						has_country_flag = ENG_abdication_crisis_dominion_will_leave
					}
				}
				set_autonomy = {
					target = AST
					autonomy_state = autonomy_free
				}
			}
			if = {
				limit = {
					NZL = {
						has_country_flag = ENG_abdication_crisis_dominion_will_leave
					}
				}
				set_autonomy = {
					target = NZL
					autonomy_state = autonomy_free
				}
			}
			if = {
				limit = {
					CAN = {
						has_country_flag = ENG_abdication_crisis_dominion_will_leave
					}
				}
				CAN = {
					create_faction = "ENG_commonwealth_of_nations"
					if = {
						limit = {
							SAF = {
								has_country_flag = ENG_abdication_crisis_dominion_will_leave
							}
						}
						add_to_faction = SAF
					}
					if = {
						limit = {
							AST = {
								has_country_flag = ENG_abdication_crisis_dominion_will_leave
							}
						}
						add_to_faction = AST
					}
					if = {
						limit = {
							NZL = {
								has_country_flag = ENG_abdication_crisis_dominion_will_leave
							}
						}
						add_to_faction = NZL
					}
				}
			}
			else_if = {
				limit = {
					SAF = {
						has_country_flag = ENG_abdication_crisis_dominion_will_leave
					}
				}
				SAF = {
					create_faction = "ENG_commonwealth_of_nations"
					if = {
						limit = {
							SAF = {
								has_country_flag = ENG_abdication_crisis_dominion_will_leave
							}
						}
						add_to_faction = SAF
					}
					if = {
						limit = {
							NZL = {
								has_country_flag = ENG_abdication_crisis_dominion_will_leave
							}
						}
						add_to_faction = NZL
					}
				}
			}
			else_if = {
				limit = {
					AST = {
						has_country_flag = ENG_abdication_crisis_dominion_will_leave
					}
				}
				AST = {
					create_faction = "ENG_commonwealth_of_nations"
					if = {
						limit = {
							NZL = {
								has_country_flag = ENG_abdication_crisis_dominion_will_leave
							}
						}
						add_to_faction = NZL
					}
				}
			}
		}
		custom_effect_tooltip = mtg_britain.2_tt
		hidden_effect = {
			if = {
				limit = {
					CAN = {
						has_country_flag = ENG_abdication_crisis_dominion_will_leave
					}
				}
				CAN = {
					country_event = {
						id = mtg_britain.16
					}
					add_ai_strategy = {
						type = alliance
						id = ENG
						value = -200
					}
				}
			}
			if = {
				limit = {
					SAF = {
						has_country_flag = ENG_abdication_crisis_dominion_will_leave
					}
				}
				SAF = {
					country_event = {
						id = mtg_britain.16
					}
					add_ai_strategy = {
						type = alliance
						id = ENG
						value = -200
					}
				}
			}
			if = {
				limit = {
					RAJ = {
						has_country_flag = ENG_abdication_crisis_dominion_will_leave
					}
					NOT = {
						has_completed_focus = RAJ_great_depression_price_controls
					}
				}
				RAJ = {
					country_event = {
						id = mtg_britain.16
					}
					add_ai_strategy = {
						type = alliance
						id = ENG
						value = -200
					}
				}
			}
			if = {
				limit = {
					AST = {
						has_country_flag = ENG_abdication_crisis_dominion_will_leave
					}
				}
				AST = {
					country_event = {
						id = mtg_britain.16
					}
					add_ai_strategy = {
						type = alliance
						id = ENG
						value = -200
					}
				}
			}
			if = {
				limit = {
					NZL = {
						has_country_flag = ENG_abdication_crisis_dominion_will_leave
					}
				}
				NZL = {
					country_event = {
						id = mtg_britain.16
					}
					add_ai_strategy = {
						type = alliance
						id = ENG
						value = -200
					}
				}
			}
			if = {
				limit = {
					BRM = {
						has_country_flag = ENG_abdication_crisis_dominion_will_leave
					}
				}
				BRM = {
					country_event = {
						id = mtg_britain.16
					}
					add_ai_strategy = {
						type = alliance
						id = ENG
						value = -200
					}
				}
			}
		}
		hidden_effect = {
			news_event = {
				id = mtg_news.62
				days = 1
			}
		}
	}
}

# Abdication Crisis Edward VIII - Marriage happens
country_event = {
	id = mtg_britain.5
	title = mtg_britain.5.t
	desc = mtg_britain.5.d
	picture = GFX_report_event_royal_parade
	is_triggered_only = yes
	trigger = {
		NOT = {
			has_country_flag = ENG_abdication_crisis_changed_mind
		}
	}
	immediate = {
		hidden_effect = {
			set_country_flag = edward_viii_married_wallis_simpson
		}
	}
	# Ok
	option = {
		name = mtg_britain.5.a
		add_popularity = {
			ideology = neutrality
			popularity = 0.05
		}
		add_stability = 0.05
		add_political_power = 50
	}
}

# Abdication Crisis Edward VIII - random event generator
country_event = {
	id = mtg_britain.6
	is_triggered_only = yes
	hidden = yes
	immediate = {
		random_list = {
			20 = {
				# Newspapers in favor of marriage
				modifier = {
					factor = 1.5
					has_country_flag = ENG_abdication_crisis_morganatic_marriage
				}
				modifier = {
					factor = 0
					has_country_flag = ENG_newspapers_in_favor
				}
				modifier = {
					factor = 0
					has_country_flag = ENG_newspapers_against
				}
				country_event = {
					id = mtg_britain.7
				}
			}
			20 = {
				# Newspapers against marriage
				country_event = {
					id = mtg_britain.8
				}
			}
			20 = {
				# Prime Minister keeps King on tight leash
				modifier = {
					factor = 0
					has_country_flag = ENG_abdication_crisis_government_fell
				}
				modifier = {
					factor = 0
					has_country_flag = ENG_newspapers_in_favor
				}
				modifier = {
					factor = 0
					has_country_flag = ENG_newspapers_against
				}
				modifier = {
					factor = 0
					has_country_flag = ENG_abdication_crisis_held_radio_speech
				}
				country_event = {
					id = mtg_britain.9
				}
			}
			20 = {
				# Parliament Opposition
				modifier = {
					factor = 0.8
					has_idea = ENG_support_for_the_king_idea
				}
				modifier = {
					factor = 0
					has_country_flag = ENG_abdication_crisis_government_fell
				}
				modifier = {
					factor = 0
					has_country_flag = ENG_parliament_opposition
				}
				country_event = {
					id = mtg_britain.10
				}
			}
			20 = {
				# Upper classes oppose marriage
				modifier = {
					factor = 0
					has_country_flag = ENG_upper_classes_oppose_marriage
				}
				country_event = {
					id = mtg_britain.11
				}
			}
			20 = {
				# Working class people support marriage
				modifier = {
					factor = 1.5
					has_country_flag = ENG_abdication_crisis_morganatic_marriage
				}
				modifier = {
					factor = 0
					has_country_flag = ENG_upper_classes_support_marriage
				}
				country_event = {
					id = mtg_britain.12
				}
			}
			200 = {
				# King gets permission to make radio broadcast for 'his side of the story'
				modifier = {
					factor = 0
					NOT = {
						has_idea = ENG_support_for_the_king_idea
					}
				}
				modifier = {
					factor = 0
					has_country_flag = ENG_abdication_crisis_tight_leash
				}
				modifier = {
					factor = 0
					has_country_flag = ENG_abdication_crisis_held_radio_speech
				}
				country_event = {
					id = mtg_britain.13
				}
			}
		}
	}
}

# Abdication Crisis Edward VIII - Newspapers in favor of marriage
country_event = {
	id = mtg_britain.7
	title = mtg_britain.7.t
	desc = mtg_britain.7.d
	picture = GFX_report_event_journalists_speech
	is_triggered_only = yes
	trigger = {
		NOT = {
			has_country_flag = ENG_abdication_crisis_changed_mind
		}
		NOT = {
			has_country_flag = edward_viii_married_wallis_simpson
		}
	}
	# Ok
	option = {
		name = mtg_britain.7.a
		add_popularity = {
			ideology = neutrality
			popularity = 0.02
		}
		add_stability = 0.05
		hidden_effect = {
			country_event = {
				id = mtg_britain.6
				days = 20
				random_days = 10
			}
		}
		clr_country_flag = ENG_newspapers_against
		clr_country_flag = ENG_prime_minister_tight_leash
		clr_country_flag = ENG_parliament_opposition
		clr_country_flag = ENG_upper_classes_oppose_marriage
		clr_country_flag = ENG_working_classes_support_marriage
		set_country_flag = ENG_newspapers_in_favor
		# NON
		trigger = {
			if = {
				limit = {
					vbm_true_non_hist_on = yes
				}
				vbm_eng_path_non = yes
			}
		}
	}
	# On second thought, maybe we shouldn't
	option = {
		name = mtg_britain.2.b
		trigger = {
			NOT = {
				has_country_flag = ENG_abdication_crisis_government_fell
			}
		}
		ai_chance = {
			factor = 0
		}
		country_event = {
			id = mtg_britain.14
			days = 40
			random_days = 10
		}
		set_country_flag = ENG_abdication_crisis_changed_mind
		if = {
			limit = {
				has_idea = ENG_support_for_the_king_idea
			}
			remove_ideas = ENG_support_for_the_king_idea
		}
		# DEM
		trigger = {
			if = {
				limit = {
					vbm_true_non_hist_on = yes
				}
				vbm_eng_path_dem_fas_com = yes
			}
		}
	}
}

# Abdication Crisis Edward VIII - Newspapers against marriage
country_event = {
	id = mtg_britain.8
	title = mtg_britain.8.t
	desc = mtg_britain.8.d
	picture = GFX_report_event_journalists_speech
	is_triggered_only = yes
	trigger = {
		NOT = {
			has_country_flag = ENG_abdication_crisis_changed_mind
		}
		NOT = {
			has_country_flag = edward_viii_married_wallis_simpson
		}
	}
	# Ok
	option = {
		name = mtg_britain.8.a
		add_popularity = {
			ideology = neutrality
			popularity = -0.02
		}
		add_stability = -0.05
		hidden_effect = {
			country_event = {
				id = mtg_britain.6
				days = 20
				random_days = 10
			}
		}
		# NON
		trigger = {
			if = {
				limit = {
					vbm_true_non_hist_on = yes
				}
				vbm_eng_path_non = yes
			}
		}
		clr_country_flag = ENG_newspapers_in_favor
		clr_country_flag = ENG_prime_minister_tight_leash
		clr_country_flag = ENG_parliament_opposition
		clr_country_flag = ENG_upper_classes_oppose_marriage
		clr_country_flag = ENG_working_classes_support_marriage
		set_country_flag = ENG_newspapers_against
	}
	# On second thought, maybe we shouldn't
	option = {
		name = mtg_britain.2.b
		trigger = {
			NOT = {
				has_country_flag = ENG_abdication_crisis_government_fell
			}
		}
		ai_chance = {
			factor = 0
		}
		country_event = {
			id = mtg_britain.14
			days = 40
			random_days = 10
		}
		# DEM
		trigger = {
			if = {
				limit = {
					vbm_true_non_hist_on = yes
				}
				vbm_eng_path_dem_fas_com = yes
			}
		}
		set_country_flag = ENG_abdication_crisis_changed_mind
		if = {
			limit = {
				has_idea = ENG_support_for_the_king_idea
			}
			remove_ideas = ENG_support_for_the_king_idea
		}
	}
}

# Abdication Crisis Edward VIII - Prime Minister keeps King on tight leash
country_event = {
	id = mtg_britain.9
	title = mtg_britain.9.t
	desc = mtg_britain.9.d
	picture = GFX_report_event_generic_sign_treaty1
	is_triggered_only = yes
	trigger = {
		NOT = {
			has_country_flag = ENG_abdication_crisis_changed_mind
		}
		NOT = {
			has_country_flag = ENG_abdication_crisis_government_fell
		}
		NOT = {
			has_country_flag = edward_viii_married_wallis_simpson
		}
	}
	# Ok
	option = {
		name = mtg_britain.9.a
		add_political_power = -50
		set_country_flag = {
			flag = ENG_abdication_crisis_tight_leash
			value = 1
			days = 31
		}
		hidden_effect = {
			country_event = {
				id = mtg_britain.6
				days = 20
				random_days = 10
			}
		}
		# NON
		trigger = {
			if = {
				limit = {
					vbm_true_non_hist_on = yes
				}
				vbm_eng_path_non = yes
			}
		}
		clr_country_flag = ENG_newspapers_in_favor
		clr_country_flag = ENG_newspapers_against
		clr_country_flag = ENG_parliament_opposition
		clr_country_flag = ENG_upper_classes_oppose_marriage
		clr_country_flag = ENG_working_classes_support_marriage
		set_country_flag = ENG_prime_minister_tight_leash
	}
	# On second thought, maybe we shouldn't
	option = {
		name = mtg_britain.2.b
		trigger = {
			NOT = {
				has_country_flag = ENG_abdication_crisis_government_fell
			}
		}
		ai_chance = {
			factor = 0
		}
		country_event = {
			id = mtg_britain.14
			days = 40
			random_days = 10
		}
		set_country_flag = ENG_abdication_crisis_changed_mind
		if = {
			limit = {
				has_idea = ENG_support_for_the_king_idea
			}
			remove_ideas = ENG_support_for_the_king_idea
		}
		# DEM
		trigger = {
			if = {
				limit = {
					vbm_true_non_hist_on = yes
				}
				vbm_eng_path_dem_fas_com = yes
			}
		}
	}
}

# Abdication Crisis Edward VIII - Parliament opposition
country_event = {
	id = mtg_britain.10
	title = mtg_britain.10.t
	desc = mtg_britain.10.d
	picture = GFX_report_event_generic_parliament
	is_triggered_only = yes
	trigger = {
		NOT = {
			has_country_flag = ENG_abdication_crisis_changed_mind
		}
		NOT = {
			has_country_flag = edward_viii_married_wallis_simpson
		}
	}
	# Ok
	option = {
		name = mtg_britain.10.a
		add_political_power = -75
		hidden_effect = {
			country_event = {
				id = mtg_britain.6
				days = 20
				random_days = 10
			}
		}
		# NON
		trigger = {
			if = {
				limit = {
					vbm_true_non_hist_on = yes
				}
				vbm_eng_path_non = yes
			}
		}
		clr_country_flag = ENG_newspapers_in_favor
		clr_country_flag = ENG_newspapers_against
		clr_country_flag = ENG_prime_minister_tight_leash
		clr_country_flag = ENG_upper_classes_oppose_marriage
		clr_country_flag = ENG_working_classes_support_marriage
		set_country_flag = ENG_parliament_opposition
	}
	# On second thought, maybe we shouldn't
	option = {
		name = mtg_britain.2.b
		trigger = {
			NOT = {
				has_country_flag = ENG_abdication_crisis_government_fell
			}
		}
		ai_chance = {
			factor = 0
		}
		country_event = {
			id = mtg_britain.14
			days = 40
			random_days = 10
		}
		# DEM
		trigger = {
			if = {
				limit = {
					vbm_true_non_hist_on = yes
				}
				vbm_eng_path_dem_fas_com = yes
			}
		}
		set_country_flag = ENG_abdication_crisis_changed_mind
		if = {
			limit = {
				has_idea = ENG_support_for_the_king_idea
			}
			remove_ideas = ENG_support_for_the_king_idea
		}
	}
}

# Abdication Crisis Edward VIII - Upper classes oppose marriage
country_event = {
	id = mtg_britain.11
	title = mtg_britain.11.t
	desc = mtg_britain.11.d
	picture = GFX_report_event_generic_rally_3
	is_triggered_only = yes
	trigger = {
		NOT = {
			has_country_flag = ENG_abdication_crisis_changed_mind
		}
		NOT = {
			has_country_flag = edward_viii_married_wallis_simpson
		}
	}
	# Ok
	option = {
		name = mtg_britain.11.a
		add_popularity = {
			ideology = neutrality
			popularity = -0.02
		}
		add_stability = -0.05
		add_political_power = -25
		hidden_effect = {
			country_event = {
				id = mtg_britain.6
				days = 20
				random_days = 10
			}
		}
		# NON
		trigger = {
			if = {
				limit = {
					vbm_true_non_hist_on = yes
				}
				vbm_eng_path_non = yes
			}
		}
		clr_country_flag = ENG_newspapers_in_favor
		clr_country_flag = ENG_newspapers_against
		clr_country_flag = ENG_prime_minister_tight_leash
		clr_country_flag = ENG_parliament_opposition
		clr_country_flag = ENG_working_classes_support_marriage
		set_country_flag = ENG_upper_classes_oppose_marriage
	}
	# On second thought, maybe we shouldn't
	option = {
		name = mtg_britain.2.b
		trigger = {
			NOT = {
				has_country_flag = ENG_abdication_crisis_government_fell
			}
		}
		ai_chance = {
			factor = 0
		}
		country_event = {
			id = mtg_britain.14
			days = 40
			random_days = 10
		}
		# DEM
		trigger = {
			if = {
				limit = {
					vbm_true_non_hist_on = yes
				}
				vbm_eng_path_dem_fas_com = yes
			}
		}
		set_country_flag = ENG_abdication_crisis_changed_mind
		if = {
			limit = {
				has_idea = ENG_support_for_the_king_idea
			}
			remove_ideas = ENG_support_for_the_king_idea
		}
	}
}

# Abdication Crisis Edward VIII - Working classes support marriage
country_event = {
	id = mtg_britain.12
	title = mtg_britain.12.t
	desc = mtg_britain.12.d
	picture = GFX_report_event_generic_rally
	is_triggered_only = yes
	trigger = {
		NOT = {
			has_country_flag = ENG_abdication_crisis_changed_mind
		}
		NOT = {
			has_country_flag = edward_viii_married_wallis_simpson
		}
	}
	# Ok
	option = {
		name = mtg_britain.12.a
		add_popularity = {
			ideology = neutrality
			popularity = 0.02
		}
		add_stability = 0.05
		hidden_effect = {
			country_event = {
				id = mtg_britain.6
				days = 20
				random_days = 10
			}
		}
		# NON
		trigger = {
			if = {
				limit = {
					vbm_true_non_hist_on = yes
				}
				vbm_eng_path_non = yes
			}
		}
		clr_country_flag = ENG_newspapers_in_favor
		clr_country_flag = ENG_newspapers_against
		clr_country_flag = ENG_prime_minister_tight_leash
		clr_country_flag = ENG_parliament_opposition
		clr_country_flag = ENG_upper_classes_oppose_marriage
		set_country_flag = ENG_working_classes_support_marriage
	}
	# On second thought, maybe we shouldn't
	option = {
		name = mtg_britain.2.b
		trigger = {
			NOT = {
				has_country_flag = ENG_abdication_crisis_government_fell
			}
		}
		ai_chance = {
			factor = 0
		}
		country_event = {
			id = mtg_britain.14
			days = 40
			random_days = 10
		}
		# DEM
		trigger = {
			if = {
				limit = {
					vbm_true_non_hist_on = yes
				}
				vbm_eng_path_dem_fas_com = yes
			}
		}
		set_country_flag = ENG_abdication_crisis_changed_mind
		if = {
			limit = {
				has_idea = ENG_support_for_the_king_idea
			}
			remove_ideas = ENG_support_for_the_king_idea
		}
	}
}

# Abdication Crisis Edward VIII - Radio speech
country_event = {
	id = mtg_britain.13
	title = mtg_britain.13.t
	desc = mtg_britain.13.d
	picture = GFX_report_event_journalists_speech
	is_triggered_only = yes
	trigger = {
		NOT = {
			has_country_flag = ENG_abdication_crisis_changed_mind
		}
		NOT = {
			has_country_flag = edward_viii_married_wallis_simpson
		}
	}
	# Ok
	option = {
		name = mtg_britain.13.a
		add_popularity = {
			ideology = neutrality
			popularity = 0.05
		}
		add_stability = 0.1
		add_political_power = 50
		set_country_flag = ENG_abdication_crisis_held_radio_speech
		hidden_effect = {
			country_event = {
				id = mtg_britain.6
				days = 20
				random_days = 10
			}
		}
		# NON
		trigger = {
			if = {
				limit = {
					vbm_true_non_hist_on = yes
				}
				vbm_eng_path_non = yes
			}
		}
	}
	# On second thought, maybe we shouldn't
	option = {
		name = mtg_britain.2.b
		trigger = {
			NOT = {
				has_country_flag = ENG_abdication_crisis_government_fell
			}
		}
		ai_chance = {
			factor = 0
		}
		country_event = {
			id = mtg_britain.14
			days = 40
			random_days = 10
		}
		set_country_flag = ENG_abdication_crisis_changed_mind
		if = {
			limit = {
				has_idea = ENG_support_for_the_king_idea
			}
			remove_ideas = ENG_support_for_the_king_idea
		}
		# DEM
		trigger = {
			if = {
				limit = {
					vbm_true_non_hist_on = yes
				}
				vbm_eng_path_dem_fas_com = yes
			}
		}
	}
}

# King abdicates - Man the Guns version
country_event = {
	id = mtg_britain.14
	title = britain.17.t
	desc = britain.17.d
	picture = GFX_report_event_generic_sign_treaty2
	is_triggered_only = yes
	immediate = {
		hidden_effect = {
			remove_ideas = ENG_king_edward
			add_ideas = ENG_george_vi
			set_country_flag = ENG_edward_viii_abdicated
		}
	}
	option = {
		name = britain.17.a
		effect_tooltip = {
			remove_ideas = ENG_king_edward
			add_ideas = ENG_george_vi
		}
	}
}

# Abdication Crisis Edward VIII - Asking Dominions what they want to do if the King goes through with it
country_event = {
	id = mtg_britain.15
	title = mtg_britain.15.t
	desc = mtg_britain.15.d
	picture = GFX_report_event_generic_parliament
	is_triggered_only = yes
	# If he goes through with it, we're out
	option = {
		name = mtg_britain.15.a
		custom_effect_tooltip = mtg_britain.15_tt
		set_country_flag = ENG_abdication_crisis_dominion_will_leave
	}
	# We will support him whatever he decides
	option = {
		name = mtg_britain.15.b
		ai_chance = {
			factor = 0
		}
		custom_effect_tooltip = mtg_britain.15_tt_2
		set_country_flag = ENG_abdication_crisis_dominion_will_stay
		if = {
			limit = {
				has_dlc = "Together for Victory"
			}
			custom_effect_tooltip = ENG_staying_loyal_tt
			if = {
				limit = {
					tag = CAN
				}
				CAN_enforce_loyalty = yes
			}
			if = {
				limit = {
					tag = SAF
				}
				SAF_enforce_loyalty = yes
			}
			if = {
				limit = {
					tag = RAJ
				}
				RAJ_enforce_loyalty = yes
			}
			if = {
				limit = {
					tag = AST
				}
				AST_enforce_loyalty = yes
			}
			if = {
				limit = {
					tag = NZL
				}
				NZL_enforce_loyalty = yes
			}
			if = {
				limit = {
					tag = BRM
				}
				NZL_enforce_loyalty = yes
			}
		}
	}
}

# Abdication Crisis Edward VIII - Notification event for the Dominions that they are leaving the Allies
country_event = {
	id = mtg_britain.16
	title = mtg_britain.16.t
	desc = mtg_britain.16.d
	picture = GFX_report_event_generic_sign_treaty3
	is_triggered_only = yes
	# Ok
	option = {
		name = mtg_britain.16.a
		if = {
			limit = {
				tag = CAN
			}
			FROM = {
				set_autonomy = {
					target = CAN
					autonomy_state = autonomy_free
				}
			}
			drop_cosmetic_tag = yes
			create_faction = "ENG_commonwealth_of_nations"
			if = {
				limit = {
					SAF = {
						has_country_flag = ENG_abdication_crisis_dominion_will_leave
					}
				}
				add_to_faction = SAF
			}
			if = {
				limit = {
					AST = {
						has_country_flag = ENG_abdication_crisis_dominion_will_leave
					}
				}
				add_to_faction = AST
			}
			if = {
				limit = {
					NZL = {
						has_country_flag = ENG_abdication_crisis_dominion_will_leave
					}
				}
				add_to_faction = NZL
			}
			hidden_effect = {
				every_other_country = {
					limit = {
						NOT = {
							tag = SAF
						}
						NOT = {
							tag = AST
						}
						NOT = {
							tag = NZL
						}
					}
					ROOT = {
						add_ai_strategy = {
							type = alliance
							id = PREV
							value = -200
						}
					}
				}
			}
		}
		if = {
			limit = {
				tag = SAF
			}
			FROM = {
				set_autonomy = {
					target = SAF
					autonomy_state = autonomy_free
				}
			}
			if = {
				limit = {
					CAN = {
						NOT = {
							has_country_flag = ENG_abdication_crisis_dominion_will_leave
						}
					}
					AST = {
						NOT = {
							has_country_flag = ENG_abdication_crisis_dominion_will_leave
						}
					}
				}
				create_faction = "ENG_commonwealth_of_nations"
				if = {
					limit = {
						NZL = {
							has_country_flag = ENG_abdication_crisis_dominion_will_leave
						}
					}
					add_to_faction = NZL
				}
				hidden_effect = {
					every_other_country = {
						limit = {
							NOT = {
								tag = NZL
							}
						}
						ROOT = {
							add_ai_strategy = {
								type = alliance
								id = PREV
								value = -200
							}
						}
					}
				}
			}
		}
		if = {
			limit = {
				tag = BRM
			}
			FROM = {
				set_autonomy = {
					target = BRM
					autonomy_state = autonomy_free
				}
			}
			drop_cosmetic_tag = yes
			if = {
				limit = {
					CAN = {
						NOT = {
							has_country_flag = ENG_abdication_crisis_dominion_will_leave
						}
					}
					AST = {
						NOT = {
							has_country_flag = ENG_abdication_crisis_dominion_will_leave
						}
					}
				}
				create_faction = "ENG_commonwealth_of_nations"
				if = {
					limit = {
						NZL = {
							has_country_flag = ENG_abdication_crisis_dominion_will_leave
						}
					}
					add_to_faction = NZL
				}
				hidden_effect = {
					every_other_country = {
						limit = {
							NOT = {
								tag = NZL
							}
						}
						ROOT = {
							add_ai_strategy = {
								type = alliance
								id = PREV
								value = -200
							}
						}
					}
				}
			}
		}
		if = {
			limit = {
				tag = RAJ
			}
			if = {
				limit = {
					NOT = {
						has_dlc = "Graveyard of Empires"
					}
				}
				FROM = {
					set_autonomy = {
						target = RAJ
						autonomy_state = autonomy_free
					}
				}
				ENG = {
					remove_from_faction = RAJ
				}
				RAJ = {
					drop_cosmetic_tag = yes
					retire_country_leader = yes
					remove_from_tech_sharing_group = commonwealth_research
				}
			}
			else = {
				RAJ = {
					country_event = {
						id = GOE_RAJ.30
						hours = 2
					}
				}
				custom_effect_tooltip = GOE_RAJ.30_we_are_leaving_tt
			}
		}
		if = {
			limit = {
				tag = AST
			}
			FROM = {
				set_autonomy = {
					target = AST
					autonomy_state = autonomy_free
				}
			}
			if = {
				limit = {
					CAN = {
						NOT = {
							has_country_flag = ENG_abdication_crisis_dominion_will_leave
						}
					}
				}
				create_faction = "ENG_commonwealth_of_nations"
				if = {
					limit = {
						SAF = {
							has_country_flag = ENG_abdication_crisis_dominion_will_leave
						}
					}
					add_to_faction = SAF
				}
				if = {
					limit = {
						NZL = {
							has_country_flag = ENG_abdication_crisis_dominion_will_leave
						}
					}
					add_to_faction = NZL
				}
				hidden_effect = {
					every_other_country = {
						limit = {
							NOT = {
								tag = SAF
							}
							NOT = {
								tag = NZL
							}
						}
						ROOT = {
							add_ai_strategy = {
								type = alliance
								id = PREV
								value = -200
							}
						}
					}
				}
			}
		}
		if = {
			limit = {
				tag = NZL
			}
			FROM = {
				set_autonomy = {
					target = NZL
					autonomy_state = autonomy_free
				}
			}
		}
	}
}

### END ABDICATION CRISIS ###