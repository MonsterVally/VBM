# REMOVE ANECHOTIC TILE
sp_naval_anechoic_tiles = {
	specialization = specialization_naval
	project_tags = sp_tag_submarine
	ai_will_do = {
		base = 1
	}
	allowed = {
		has_dlc = "Gotterdammerung"
		#VBM REMOVE ANECHOTIC TILE
		always = no
	}
	available = {
		FROM = {
			if = {
				limit = {
					has_dlc = "Man the Guns"
				}
				has_tech = basic_ship_hull_submarine
			}
			else = {
				has_tech = basic_submarine
			}
		}
	}
	breakthrough_cost = {
		specialization_naval = 1
	}
	resource_cost = {
		resources = {
			rubber = 12
			steel = 8
		}
	}
	complexity = sp_complexity.medium
	prototype_time = sp_time.prototype.medium
	project_output = {
		country_effects = {
			if = {
				limit = {
					NOT = {
						has_dlc = "Man the Guns"
					}
				}
				custom_effect_tooltip = {
					localization_key = sp_naval_anechoic_tiles_non_mtg_tt
				}
			}
		}
		enable_equipment_modules = {
			limit = {
				has_dlc = "Man the Guns"
			}
			ship_anechoic_tile
		}
		enable_subunits = {
		}
	}
	generic_prototype_rewards = {
		sp_naval_generic_reward_scientist_xp_1
		sp_naval_generic_reward_scientist_xp_2
		sp_naval_generic_reward_scientist_xp_3
		sp_naval_generic_reward_navy_xp_1
		sp_naval_generic_reward_navy_xp_2
		sp_naval_generic_reward_navy_xp_3
		sp_naval_generic_reward_major_progress_1
		sp_naval_generic_reward_major_progress_2
		sp_naval_generic_reward_major_progress_3
		sp_naval_generic_reward_test_failure_1
		sp_naval_generic_reward_test_failure_2
		sp_naval_generic_reward_test_failure_3
	}
	unique_prototype_rewards = {
		sp_naval_anechoic_tiles_unique_reward_a = {
			fire_only_once = yes
			threshold = {
				min = 40
				max = 90
			}
			weight = {
				base = 100
			}
			option = {
				token = sp_naval_anechoic_tiles_preference_a
				iteration_output = {
					country_effects = {
					}
					equipment_bonus = {
						ship_hull_submarine = {
							build_cost_ic = 0.05
							surface_detection = 0.1
							instant = yes
						}
					}
				}
			}
			option = {
				token = sp_naval_anechoic_tiles_preference_b
				iteration_output = {
					country_effects = {
					}
					equipment_bonus = {
						ship_hull_submarine = {
							build_cost_ic = 0.1
							sub_visibility = -0.05
							instant = yes
						}
					}
				}
			}
			option = {
				token = sp_naval_anechoic_tiles_preference_c
				default = yes
				iteration_output = {
					country_effects = {
					}
					equipment_bonus = {
						ship_hull_submarine = {
							build_cost_ic = -0.05
							instant = yes
						}
					}
				}
			}
		}
	}
}

# Midget Submarine
# VBM REMOVED MIDGET SUBMARINES
sp_naval_midget_submarine = {
	specialization = specialization_naval
	project_tags = {
		sp_tag_submarine
	}
	allowed = {
		# VBM REMOVED MIDGET SUBMARINES
		always = no
	}
	available = {
		FROM = {
			if = {
				limit = {
					has_dlc = "Man the Guns"
				}
				has_tech = early_ship_hull_submarine
			}
			else = {
				has_tech = early_submarine
			}
		}
	}
	complexity = sp_complexity.medium
	prototype_time = sp_time.prototype.short
	resource_cost = {
		resources = {
			steel = 6
		}
	}
	breakthrough_cost = {
		specialization_naval = 1
	}
	project_output = {
		enable_equipments = {
			limit = {
				has_dlc = "Man the Guns"
			}
			ship_hull_midget_submarine
		}
		enable_equipments = {
			limit = {
				not = {
					has_dlc = "Man the Guns"
				}
			}
			midget_submarine
		}
		country_effects = {
			if = {
				limit = {
					has_dlc = "Man the Guns"
				}
				add_design_template_bonus = {
					name = sp_naval_midget_submarine_free_design
					uses = 1
					cost_factor = 1
					equipment = ship_hull_midget_submarine
				}
			}
			if = {
				#Italian content from Midget Submarines focus moved here (focus now completes this SP)
				limit = {
					original_tag = ITA
				}
				if = {
					limit = {
						has_dlc = "Man the Guns"
					}
					create_equipment_variant = {
						name = "CB Class"
						type = ship_hull_midget_submarine
						allow_without_tech = yes						# Display tooltip as if we have the tech.
						name_group = ITA_SS_HISTORICAL
						parent_version = 0
						allow_without_tech = yes						# Display tooltip as if we have the tech.
						mark_older_equipment_obsolete = yes
						modules = {
							fixed_ship_torpedo_slot = ship_torpedo_sub_2
							fixed_ship_engine_slot = sub_ship_engine_2
						}
					}
					add_equipment_production = {
						equipment = {
							type = ship_hull_midget_submarine
							creator = "ITA"
							version_name = "CB Class"
						}
						name = "Ammiraglio Millo"
						requested_factories = 1
						progress = 0.35
						amount = 2
					}
				}
				else = {
					create_equipment_variant = {
						name = "CB Class"
						type = midget_submarine
						allow_without_tech = yes						# Display tooltip as if we have the tech.
						name_group = ITA_SS_HISTORICAL
						parent_version = 0
						allow_without_tech = yes						# Display tooltip as if we have the tech.
						mark_older_equipment_obsolete = yes
						upgrades = {
							sub_torpedo_upgrade = 2
							sub_engine_upgrade = 2
						}
					}
					add_equipment_production = {
						equipment = {
							type = midget_submarine
							creator = "ITA"
							version_name = "CB Class"
						}
						name = "Ammiraglio Millo"
						requested_factories = 1
						progress = 0.35
						amount = 2
					}
				}
			}
		}
	}
	generic_prototype_rewards = {
		sp_naval_generic_reward_scientist_xp_1
		sp_naval_generic_reward_scientist_xp_2
		sp_naval_generic_reward_scientist_xp_3
		sp_naval_generic_reward_navy_xp_1
		sp_naval_generic_reward_navy_xp_2
		sp_naval_generic_reward_navy_xp_3
		sp_naval_generic_reward_major_progress_1
		sp_naval_generic_reward_major_progress_2
		sp_naval_generic_reward_major_progress_3
		sp_naval_generic_reward_test_failure_1
		sp_naval_generic_reward_test_failure_2
		sp_naval_generic_reward_test_failure_3
		sp_naval_generic_failure_torpedo_accident
	}
	unique_prototype_rewards = {
		sp_naval_midget_submarine_unique_reward_a = {
			fire_only_once = yes
			threshold = {
				min = 40
				max = 90
			}
			weight = {
				base = 100
			}
			option = {
				token = sp_naval_midget_submarine_preference_a
				iteration_output = {
					country_effects = {
						if = {
							limit = {
								has_dlc = "Man the Guns"
							}
							add_equipment_bonus = {
								name = sp_midget_submarine_eq_bonus_stealth
								bonus = {
									ship_hull_midget_submarine = {
										naval_range = -0.2
										sub_visibility = -0.1
									}
								}
							}
						}
						else = {
							add_equipment_bonus = {
								name = sp_midget_submarine_eq_bonus_stealth
								bonus = {
									midget_submarine = {
										naval_range = -0.2
										sub_visibility = -0.1
									}
								}
							}
						}
					}
				}
			}
			option = {
				token = sp_naval_midget_submarine_preference_b
				default = yes
				iteration_output = {
					country_effects = {
						if = {
							limit = {
								has_dlc = "Man the Guns"
							}
							add_equipment_bonus = {
								name = sp_midget_submarine_eq_bonus_reliability
								bonus = {
									ship_hull_midget_submarine = {
										reliability = 0.1
									}
								}
							}
						}
						else = {
							add_equipment_bonus = {
								name = sp_midget_submarine_eq_bonus_reliability
								bonus = {
									midget_submarine = {
										reliability = 0.1
									}
								}
							}
						}
					}
				}
			}
			option = {
				token = sp_naval_midget_submarine_preference_c
				iteration_output = {
					country_effects = {
						if = {
							limit = {
								has_dlc = "Man the Guns"
							}
							add_equipment_bonus = {
								name = sp_midget_submarine_eq_bonus_range
								bonus = {
									ship_hull_midget_submarine = {
										naval_range = 0.2
										sub_visibility = 0.1
									}
								}
							}
						}
						else = {
							add_equipment_bonus = {
								name = sp_midget_submarine_eq_bonus_range
								bonus = {
									midget_submarine = {
										naval_range = 0.2
										sub_visibility = 0.1
									}
								}
							}
						}
					}
				}
			}
		}
	}
}
